<!DOCTYPE html><!--[if lt IE 7]> <html class="no-js lt-ie9 lt-ie8 lt-ie7" lang=""> <![endif]--><!--[if IE 7]> <html class="no-js lt-ie9 lt-ie8" lang=""> <![endif]--><!--[if IE 8]> <html class="no-js lt-ie9" lang=""> <![endif]--><!--[if gt IE 8]><!--> <html class="no-js" lang=""> <!--<![endif]-->
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta name="keywords" content="bregier, fichier, file, frederic, gateway, goldengate, http, java, libre, moniteur, monitor, open, openr66, route, source, ssh, transfer, transfert, waarp" />
<meta name="description" content="Waarp project" />
<meta name="robots" content="index,follow" />
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-1" />
<meta name="generator" content="Site Studio 6 (www.effectivestudios.com)" />
<link rel="stylesheet" href="Waarp.css" type="text/css" />
<style type="text/css">
a {
	color:#0000FF;
	text-decoration:underline;
}
a:visited {
	text-decoration:underline;
}
a:hover {
	text-decoration:underline;
}
a img {
	border:#000000 0px none;
}
</style>
<title>Waarp - Waarp R66-Protocol</title>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1">
<!-- Bootstrap CSS -->
<link rel="stylesheet" href="css/magic-bootstrap-min.css">
<!-- special CSS -->
<style type="text/css">
@-moz-document url-prefix() { fieldset { display: table-cell; } }
</style>
<!-- JQuery -->
<script type="text/javascript" src="js/jquery-1.11.2.min.js"></script>
<script src="js/modernizr-2.8.3-respond-1.4.2.min.js"></script>
<!-- Bootstrap -->
<script type="text/javascript" src="js/bootstrap.min.js"></script>
<link rel="stylesheet" href="Waarp.css" type="text/css" />
<script>
$( document ).ready(function(){
 $.get( "res/waarpmenu.html", function(data) {
 $( "#waarpmenu" ).html(data);
 $("body").removeAttr("class").removeAttr( "style" );
 $("#Comp2_sys_doctext").addClass("panel-body container-fluid");
 var curpage= "r660/under0/protocol";
 var splitPages = curpage.split("/");
 $.each( splitPages, function( index, value ){ $("#"+value).addClass("active"); });
  $('ul.dropdown-menu [data-toggle=dropdown]').on('click', function(event) {
   event.preventDefault(); 
   event.stopPropagation(); 
   $(this).parent().siblings().removeClass('open');
   $(this).parent().toggleClass('open');
  });
 });
});
</script>
<style type="text/css">
.dropdown-submenu{position:relative;}
.dropdown-submenu>.dropdown-menu{top:0;left:100%;margin-top:-6px;margin-left:-1px;-webkit-border-radius:0 6px 6px 6px;-moz-border-radius:0 6px 6px 6px;border-radius:0 6px 6px 6px;}
.dropdown-submenu>a:after{display:block;content:" ";float:right;width:0;height:0;border-color:transparent;border-style:solid;border-width:5px 0 5px 5px;border-left-color:#cccccc;margin-top:5px;margin-right:-10px;}
.dropdown-submenu:hover>a:after{border-left-color:#555;}
.dropdown-submenu.pull-left{float:none;}.dropdown-submenu.pull-left>.dropdown-menu{left:-100%;margin-left:10px;-webkit-border-radius:6px 0 6px 6px;-moz-border-radius:6px 0 6px 6px;border-radius:6px 0 6px 6px;}
.h1 { font-size:14px; color:#333333; font-weight:bold;}
.h2, .h3 { font-size:12pt; color:#333333; font-weight:bold; }
.h4, .h5, .h6 { font-size:13px; color:#333333; font-weight:bold; }
</style>
</head>
<body class="normal" style="font-family:Verdana,sans-serif;font-size:8pt;color:#000000;margin:0px;padding:0px;background-color:#FFFFFF;">
<div id="Comp1_CodeRelayer"><!--[if lt IE 8]>
<p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
<![endif]-->
<div class="cover" id="waarpmenu" />
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-1693657-4', 'auto');
  ga('send', 'pageview');

</script>
</div>
<div style="text-align:left;margin:0px 4px;">
<h1 class="h1">Waarp R66-Protocol</h1>
<div id="Comp2_sys_doctext"><p style="text-align:justify;"><span style="font-size:11pt;">We describe here the logic of the protocol. It has been designed to be efficient, secured and to fullfill specific requirements of MFT and integration in IT.</span></p>
<p style="text-align:justify;">&nbsp;</p>
<p style="text-align:justify;"><span style="font-size:11pt;">A simplified picture is shown here:</span></p>
<p style="text-align:justify;"><img title="openr66-protocol" alt="openr66-protocol" src="res/document/openr66protocol.png" width="1168" height="220" /></p>
<p style="text-align:justify;"><span style="font-size:11pt;">First we describe the different value that can be found.</span></p>
<ul>
<li>
<div style="text-align:justify;"><span style="font-size:11pt;">A Request (DbTaskRunner) can have several UpdatedInfo status:</span></div>
<ul>
<li><div style="text-align:justify;"><span style="font-size:11pt;">UNKNOWN : no particular information on it.</span></div></li>

<li><div style="text-align:justify;"><span style="font-size:11pt;">NOTUPDATED : in used by other database object when they are taken into account.</span></div></li>

<li><div style="text-align:justify;"><span style="font-size:11pt;">INTERRUPTED : a request is interrupted but can be rescheduled.</span></div></li>

<li><div style="text-align:justify;"><span style="font-size:11pt;">TOSUBMIT : a request is proposed to be submited by the Commander (or other database object are supposed to be taken into account).</span></div></li>

<li><div style="text-align:justify;"><span style="font-size:11pt;">INERROR : a request is in error and can not be submited by the Commander until its status is changed explicitely.</span></div></li>

<li><div style="text-align:justify;"><span style="font-size:11pt;">RUNNING : a request is currently running.</span></div></li>

<li>
<div style="text-align:justify;"><span style="font-size:11pt;">DONE : a request is over and fully done.</span></div></li></ul></li></ul>
<ul>
<li><div style="text-align:justify;"><span style="font-size:11pt;">A Request can have several Step values:</span></div><ul>
<li><div style="text-align:justify;"><span style="font-size:11pt;">NOTASK : the request has never started.</span></div></li>

<li><div style="text-align:justify;"><span style="font-size:11pt;">PRETASK : the request is currently in Pre transfer step.</span></div></li>

<li><div style="text-align:justify;"><span style="font-size:11pt;">TRANSFERTASK : the request is currently in transfer step.</span></div></li>

<li><div style="text-align:justify;"><span style="font-size:11pt;">POSTTASK : the request is currently in Post transfer step (valid transfer only).</span></div></li>

<li><div style="text-align:justify;"><span style="font-size:11pt;">ALLDONETASK : the request is fully finished (UpdatedInfo is in DONE status too).</span></div></li>

<li>
<div style="text-align:justify;"><span style="font-size:11pt;">ERRORTASK : the request is currently in the Error step while an error occurs (either in PRE, TRANSFER or POST step).</span></div></li></ul></li>


<li>
<div style="text-align:justify;"><span style="font-size:11pt;">A Request has two Step values:</span></div>
<ul>
<li><div style="text-align:justify;"><span style="font-size:11pt;">GlobalStep : the current request step value</span></div></li>

<li>
<div style="text-align:justify;"><span style="font-size:11pt;">GlobalLastStep : this is the last valid request step value. When GlobalStep is in ERROR step, GlobalLastStep says in which step it was before entering in error. This information is used to enable restart of the Request from this valid last step.</span></div></li></ul></li></ul>
<ul>
<li>
<div style="text-align:justify;"><span style="font-size:11pt;">Each Step values and UpdatedInfo has an ErrorCode detailed information:</span></div>
<ul>
<li><div style="text-align:justify;"><span style="font-size:11pt;"><em>InitOk</em> : stands for correct initialization of the Request (startup and authentication)</span></div></li>

<li><div style="text-align:justify;"><span style="font-size:11pt;"><em>PreProcessingOk, TransferOk, PostProcessingOk</em> : stand for correct ending of the specified step</span></div></li>

<li><div style="text-align:justify;"><span style="font-size:11pt;"><em>CompleteOk</em> : stands for all action are correct (ALLDONE for step and DONE for UpdatedInfo)</span></div></li>

<li><div style="text-align:justify;"><span style="font-size:11pt;"><em>Running</em> : stands for current Step is in Running status.</span></div></li>

<li><div style="text-align:justify;"><span style="font-size:11pt;"><em>StoppedTransfer, CanceledTransfer</em> : stand for a Request where an action stopped or canceled the given Request. A Stopped Request can be restart from the current status. A Canceled Request starts from the beginning of the current step. For instance for the Transfer step, Stopped will imply that restart is from the current valid transferred block, while Cancel will imply to restart from the very beginning of the transfer (first block).</span></div></li>

<li><div style="text-align:justify;"><span style="font-size:11pt;"><em>QueryAlreadyFinished</em> : stands for special code where the Request is in fact remotely already finished and so can be finished locally.</span></div></li>

<li><div style="text-align:justify;"><span style="font-size:11pt;">Other codes specifies different kinds of error (NotKnownHost, Shutdown, RemoteError, ...):</span>&nbsp;</div></li>

<li>
<div style="text-align:justify;">
<ul>
<li><span style="color:#000000;"><span style="font-size:11pt;"><em>ConnectionImpossible&nbsp;</em>: connection is impossible (local or remote)</span></span> 
</li><li><span style="color:#000000;"><span style="font-size:11pt;"><em>BadAuthent&nbsp;</em>: authentication is in error (local or remote)</span></span> 
</li><li><span style="color:#000000;"><span style="font-size:11pt;"><em>ExternalOp&nbsp;</em>: external operation is in error (pre, post or error actions)</span></span> 
</li><li><span style="color:#000000;"><span style="font-size:11pt;"><em>TransferError&nbsp;</em>: transfer is in error (for instance, uncorrect block)</span></span> 
</li><li><span style="color:#000000;"><span style="font-size:11pt;"><em>MD5Error&nbsp;</em>: transfer is in error due to a bad MD5 checking (in MD5 mode)</span></span> 
</li><li><span style="color:#000000;"><span style="font-size:11pt;"><em>Disconnection&nbsp;</em>: the network was disconnected</span></span> 
</li><li><span style="color:#000000;"><span style="font-size:11pt;"><em>RemoteShutdown&nbsp;</em>: the remote host is in shutdown</span></span> 
</li><li><span style="color:#000000;"><span style="font-size:11pt;"><em>Shutdown&nbsp;</em>: the local host is in shutdown</span></span> 
</li><li><span style="color:#000000;"><span style="font-size:11pt;"><em>FinalOp&nbsp;</em>: a final operation (not an external operation) is in error (for instance the finalization of the received file)</span></span> 
</li><li><span style="color:#000000;"><span style="font-size:11pt;"><em>Unimplemented&nbsp;</em>: the requested command is unimplemented (for instance, a task in a rule is unknown)</span></span> 
</li><li><span style="color:#000000;"><span style="font-size:11pt;"><em>RemoteError&nbsp;</em>: a remote error was received and&nbsp;stops the transfer</span></span> 
</li><li><span style="color:#000000;"><span style="font-size:11pt;"><em>Internal&nbsp;</em>: an internal error arrives</span></span> 
</li><li><span style="color:#000000;"><span style="font-size:11pt;"><em>Warning&nbsp;</em>: an external execution (pre or post operation) is executed well but with a warning (code 1)</span></span> 
</li><li><span style="color:#000000;"><span style="font-size:11pt;"><em>Unknown&nbsp;</em>: an unknown error arrives</span></span> 
</li><li><span style="color:#000000;"><span style="font-size:11pt;"><em>QueryStillRunning&nbsp;: </em>a required transfer during a restart is still in transfer</span></span> 
</li><li><span style="color:#000000;"><span style="font-size:11pt;"><em>NotKnownHost&nbsp;: </em>the remote host is unknown</span></span> 
</li><li><span style="color:#000000;"><span style="font-size:11pt;"><em>QueryRemotelyUnknown&nbsp;: </em>a required transfer during a restart or other commands should exist but is not identified on the remote host (for instance after a purge of log)</span></span> 
</li><li><span style="color:#000000;"><span style="font-size:11pt;"><em>FileNotFound&nbsp;: </em>the file is not found</span></span> 
</li><li><span style="color:#000000;"><span style="font-size:11pt;"><em>CommandNotFound&nbsp;: </em>the Command is not found</span></span>&nbsp;</li></ul></div>
<ul>
<li><span style="color:#000000;"><span style="font-size:11pt;"><em>PassThroughMode&nbsp;: </em>the requested transfer (restart) is in PassThrough mode and is not compatible with the required action</span></span> 
</li><li><span style="color:#000000;"><span style="font-size:11pt;"><em>IncorrectCommand&nbsp;: </em>the command passed to the server is incorrect and cannot continue</span></span> 
</li><li><span style="color:#000000;"><span style="font-size:11pt;"><em>FileNotAllowed&nbsp;: </em>the File requested is not allowed (due to a path not allowed for instance)</span></span> 
</li><li><span style="color:#000000;"><span style="font-size:11pt;"><em>SizeNotAllowed&nbsp;: </em>the file size is not allowed (either because the size is out of the limit or because the working/recv directories cannot host this file due to insufficient space available)</span></span></li></ul></li></ul></li></ul>
<p style="text-align:justify;"></p>
<p style="text-align:justify;"><span style="font-size:11pt;">A request of transfer follows a sequential logic:</span></p>
<p style="text-align:justify;">&nbsp;</p>
<p style="text-align:justify;"><span style="font-size:11pt;"><strong>Startup</strong></span></p>
<p style="text-align:justify;"><span style="font-size:11pt;"><ins>Requester:</ins></span></p>
<ol>
<li><p style="text-align:justify;"><span style="font-size:11pt;">The requester checks first if the given partner name is an alias, and if so, replaces it by the real host id.</span></p></li>

<li><p style="text-align:justify;"><span style="font-size:11pt;">The request is registered in the database with a TOSUBMIT status.</span></p></li>

<li><p style="text-align:justify;"><span style="font-size:11pt;">A Request that was in a INTERRUPTED status is changed in a TOSUBMIT status.</span></p></li>

<li><p style="text-align:justify;"><span style="font-size:11pt;">The Commander get some requests with the TOSUBMIT status and makes them as RUNNING status.</span></p></li>

<li><p style="text-align:justify;"><span style="font-size:11pt;">The Commander submits those requests as separates ClientRunners.</span></p></li>

<li><p style="text-align:justify;"><span style="font-size:11pt;">The ClientRunner first checks that the given Request is not a "Self Requested" request, meaning that only requester host can execute a ClientRunner, except if this request was in the POSTTASK step so that Requested Host can finalize the request.</span></p></li>

<li><p style="text-align:justify;"><span style="font-size:11pt;">The ClientRunner gets the remote requested Host address and tries to open the connection. If a network conection with the given requested host is already opened, this network connection is reused by the new ClientRunner.</span></p></li>

<li>
<p style="text-align:justify;"><span style="font-size:11pt;">The connection can use SSL support (different port than non SSL). This is an option of transfer. This option is selected while selecting the Host ID for SSL support for the remote Requested Host. This option is CPU and Memory consuming.</span></p></li></ol>
<p style="text-align:justify;"><span style="font-size:11pt;"><ins>Requester and Requested:</ins></span></p>
<ol>
<li>
<p style="text-align:justify;"><span style="font-size:11pt;">Once the network connection is found, a private connection (in memory connection) is opened to enable the multiplexing of this request with other requests on the same network connection. This private connection is attached to a new LocalChannelReference which references the Request, the session, the remote and&nbsp;private connections. A valid LocalChannelReference contains two private connection Ids, one for the local private connection, and one for the remote private connection.</span></p>
<ol>
<li><p style="text-align:justify;"><span style="font-size:11pt;">A <strong>Startup</strong> Message is sent to the local private connection to initiate it.</span></p></li>

<li>
<p style="text-align:justify;"><span style="font-size:11pt;">The same <strong>Startup</strong> Message is sent on the remote private side (when connection occurs) to initiate the relation between them and to instantiate the same LocalChannelReference on the remote host.</span></p></li></ol></li></ol>
<p style="text-align:justify;"><span style="font-size:11pt;"><strong>Authentication</strong></span></p>
<p style="text-align:justify;"><span style="font-size:11pt;"><ins>Requester:</ins></span></p>
<ol>
<li>
<p style="text-align:justify;"><span style="font-size:11pt;">Once the LocalChannelReference is OK, the Requester host sends an <strong>Authent</strong> Message in order to authenticate this host.</span></p></li></ol>
<p style="text-align:justify;"><span style="font-size:11pt;"><ins>Requested:</ins></span></p>
<ol>
<li>
<p style="text-align:justify;"><span style="font-size:11pt;">The Requested host sends back its own <strong>Authent</strong> Message too.</span></p></li></ol>
<p style="text-align:justify;"><span style="font-size:11pt;"><strong>Request</strong></span></p>
<p style="text-align:justify;"><span style="font-size:11pt;"><ins>Requester:</ins></span></p>
<ol>
<li>
<p style="text-align:justify;"><span style="font-size:11pt;">Once authenticated, the Requester Host sends the <strong>Request</strong> Message.</span></p></li></ol>
<p style="text-align:justify;"><span style="font-size:11pt;"><ins>Requested:</ins></span></p>
<ol>
<li>
<p style="text-align:justify;"><span style="font-size:11pt;">The Requested Host check if the authentication and the request are compatibles, check some specific options on the request itself (start, restart, &hellip;), the status of the file if it is the sender, then it runs its Pre Task step</span></p></li></ol>
<ul>
<li>
<ul>
<li>
<p style="text-align:justify;"><span style="font-size:11pt;">The Request is in&nbsp;PreProcessingOK as status.</span></p></li></ul></li></ul>
<p style="text-align:justify;"><span style="font-size:11pt;"><strong>Pre-Tasks</strong></span></p>
<p style="text-align:justify;"><span style="font-size:11pt;"><ins>Requested:</ins></span></p>
<ol>
<li>
<p style="text-align:justify;"><span style="font-size:11pt;">If the Pre Task step is ok, it sends back the validated <strong>Request</strong> Message to the Requester Host. </span></p></li></ol>
<ul>
<li>
<ul>
<li>
<p style="text-align:justify;"><span style="font-size:11pt;">The Request is in InitOk as detailed information on requester side.</span></p></li></ul></li></ul>
<p style="text-align:justify;"><span style="font-size:11pt;"><ins>Requester:</ins></span></p>
<ol>
<li>
<p style="text-align:justify;"><span style="font-size:11pt;">The Requester Host check if the authentication and the request are compatibles, check some specific options on the request itself (start, restart, &hellip;), the status of the file if it is the sender.</span></p></li></ol>
<ul>
<li>
<ul>
<li>
<p style="text-align:justify;"><span style="font-size:11pt;">The Request is in InitOk. </span></p></li></ul></li></ul>
<ol>
<li>
<p style="text-align:justify;"><span style="font-size:11pt;">The validated Request is now running the Pre Task step. </span></p></li></ol>
<ul>
<li>
<ul>
<li>
<p style="text-align:justify;"><span style="font-size:11pt;">Once finished, the Request is in PreProcessingOK status.</span></p></li></ul></li></ul>
<p style="text-align:justify;"><span style="font-size:11pt;">During pre-start, some preconditions could change (file name, file size, transfer information): if so, a special message is send in order to change the remote corresponding information.</span></p>
<p style="text-align:justify;">&nbsp;</p>
<p style="text-align:justify;"><span style="font-size:11pt;"><strong>Data Transfer</strong></span></p>
<p style="text-align:justify;"><span style="font-size:11pt;"><ins>Sender:</ins></span></p>
<ol>
<li><p style="text-align:justify;"><span style="font-size:11pt;">Now the transmission can start. From now on, this is the sender that leads the communication, no more the requester (it could be the same host however, depending on the way of transfer). The sender (which could be either the Requested or the Requester host) launch its own RetrieveRunner. This RetrieveRunner sends to the other host all <strong>DataBlock</strong> Messages.</span></p></li>

<li><p style="text-align:justify;"><span style="font-size:11pt;">Each <strong>DataBlock</strong> Message can include a Hash control (MD5 or SHA or other) of the packet in it (option of transfer). This option is not mandatory and is CPU consuming.</span></p></li>

<li>
<p style="text-align:justify;"><span style="font-size:11pt;">Once all <strong>DataBlock</strong> are sent, the RetrieveRunner sends an <strong>EndTransfer</strong> Message to the receiver host.</span></p></li></ol>
<p style="text-align:justify;"><span style="font-size:11pt;"><ins>Receiver:</ins></span></p>
<ol>
<li><div style="text-align:justify;"><span style="font-size:11pt;">For each <strong>DataBlock</strong>, the receiver appends this new block, checking the order of the block, and optionnaly the hash control.</span></div></li>

<li>
<div style="text-align:justify;"><span style="font-size:11pt;">Once all blocks are received, the <strong>EndTransfer</strong> Message indicates the end of transmission from the Sender.</span></div></li></ol>
<p style="text-align:justify;"><strong><span style="font-size:11pt;">Post-Actions</span></strong></p>
<p style="text-align:justify;"><ins><span style="font-size:11pt;">Receiver:</span></ins></p>
<ol>
<li>
<p style="text-align:justify;"><span style="font-size:11pt;">The receiver host executes the Post actions.</span></p></li></ol>
<ul>
<li>
<ul>
<li>
<p style="text-align:justify;"><span style="font-size:11pt;">The Request is in PostProcesseingOk status.</span></p></li></ul></li></ul>
<ol>
<li>
<p style="text-align:justify;"><span style="font-size:11pt;">The receiver host sends back the validated <strong>EndTransfer</strong> Message. </span></p></li></ol>
<ul>
<li>
<ul>
<li>
<p style="text-align:justify;"><span style="font-size:11pt;">The Request is in TransferOk status on sender side.</span></p></li></ul></li></ul>
<p style="text-align:justify;"><ins><span style="font-size:11pt;">Sender:</span></ins></p>
<ol>
<li>
<p style="text-align:justify;"><span style="font-size:11pt;">The Request is now on Finalize way. Sender host executes the Post actions.</span></p></li></ol>
<ul>
<li>
<ul>
<li>
<p style="text-align:justify;"><span style="font-size:11pt;">The Request is in PostProcesseingOk status.</span></p></li></ul></li></ul>
<p style="text-align:justify;"><strong><span style="font-size:11pt;">End Request</span></strong></p>
<p style="text-align:justify;"><ins><span style="font-size:11pt;">Sender:</span></ins></p>
<ol>
<li>
<p style="text-align:justify;"><span style="font-size:11pt;">Once the PostProcessing is over, the RetrieveRunner (Sender) sends to the remote host a <strong>EndRequest</strong> Message.</span></p></li></ol>
<p style="text-align:justify;"><ins><span style="font-size:11pt;">Receiver:</span></ins></p>
<ol>
<li>
<p style="text-align:justify;"><span style="font-size:11pt;">The remote host sends back the validated <strong>EndRequest</strong> Message.</span></p></li></ol>
<p style="text-align:justify;"><ins><span style="font-size:11pt;">Receiver and Sender:</span></ins></p>
<ol>
<li>
<p style="text-align:justify;"><span style="font-size:11pt;">The Request is now totally finished and its status is CompleteOk ALLDONE.</span></p></li></ol>
<p style="text-align:justify;">&nbsp;</p>
<p style="text-align:justify;"><span style="font-size:11pt;">At each step, an error can occurs and will stop the request, setting its UpdatedInfo to INERROR or INTERRUPTED status. The GlobalStep could be in ERROR status if the ERROR step action is run.</span></p>
<p style="text-align:justify;"></p>
<p style="text-align:justify;"></p>
<p style="text-align:justify;">&nbsp;</p></div>
<p>&nbsp;</p></div>
</body>
</html>
