<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta name="generator" content="Site Studio 6 (www.effectivestudios.com)" />
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-1" />
<meta http-equiv="imagetoolbar" content="no" />
<meta name="keywords" content="bregier, fichier, file, frederic, gateway, goldengate, http, java, libre, moniteur, monitor, open, openr66, route, source, ssh, transfer, transfert, waarp" />
<meta name="description" content="Waarp project" />
<meta name="robots" content="index,follow" />
<link rel="stylesheet" href="Waarp.css" type="text/css" />
<style type="text/css">
a {
	color:#0000FF;
	text-decoration:none;
}
a:visited {
	text-decoration:none;
}
a:hover {
	text-decoration:underline;
}
a img {
	border:#000000 0px none;
}
</style>
<title>Waarp - Waarp R66-Protocol</title>
	<script type="text/javascript">
//<![CDATA[
	function MHGetRef(str)
	{
		if(document.all)
			return document.all[str];
		else
			return document.getElementById(str);
	}

	function MHSwitchImage(strID, strFileName)
	{
		var obj = MHGetRef(strID);
		if(obj == null || obj + "" == "undefined") return;
		obj.src = strFileName;
	}
//]]>
	</script>
<script type="text/javascript">
//<![CDATA[
	function mvgGetRef(str)						{ return (document.all) ? document.all[str] : document.getElementById(str); }
	function mvgSetClass(strId, strClass)		{ var obj = mvgGetRef(strId); if(obj != null && typeof(obj) != "undefined") obj.className = strClass; }
	function mvgSwitchImage(strId, strFileName)	{ var obj = mvgGetRef(strId); if(obj != null && typeof(obj) != "undefined") obj.src = strFileName; }
//]]>
</script>
</head>
<body class="normal" style="margin:0px;padding:0px;background-color:#FFFFFF;background-image:url(gre/gre6696.png);background-position:left top;background-repeat:repeat-y;">
<div style="text-align:left;">
<div style="background-color:#EF6D00;text-align:left;"><a href="index.html"><img title="GoldenGate" style="border:none;" height="49" alt="GoldenGate" src="res/openlsd/waarp.jpg" width="74" /></a><img title="Waarp" style="border-top-style:none; border-bottom:#000000 0px solid; border-right-style:none; border-left-style:none;" height="40" alt="Waarp" src="gre/gre6697.png" width="99" /></div>
<div style="border-right:none;border-left:none;border-bottom:2px solid #FFFFFF;border-top:1px solid #FFFFFF;background-color:#F9DEC7;text-align:left;"><table cellpadding="0" cellspacing="0" border="0" style="width:100%;margin:0;padding:0;border:0 solid none;"><tr><td style="vertical-align:top;"><div></div></td><td style="height:1px;width:1px;margin:0;padding:0;border:0 solid none;"><div style="height:1px;width:1px;margin:0;padding:0;border:0 solid none;"></div></td></tr></table></div>
<table style="border:none;" cellspacing="0" cellpadding="0" width="100%">
<tbody>
<tr>
<td style="vertical-align:top;width:100px;background-color:#FFFFFF;">&nbsp;</td>
<td style="padding-right:5px;padding-left:5px;padding-bottom:0px;vertical-align:top;width:100%;padding-top:0px;">
<div id="Comp4_MenuHorizontal">
<table border="0" cellpadding="0" cellspacing="0" width="100%">
	<tr style="background-image:url(gre/gre6668.png);background-repeat:repeat-x;background-position:left top;">
		<td id="MH1_0"><a href="WaarpR66Presentation.html" onmouseover="MHSwitchImage('MH1_0_img', 'gre/gre6707.png');" onmouseout="MHSwitchImage('MH1_0_img', 'gre/gre6706.png');"><img id="MH1_0_img" src="gre/gre6706.png" width="179" height="26" alt="Waarp R66-Presentation" style="border:none;display:block;" /></a></td>
		<td></td><td><img src="gre/gre6667.png" height="18" width="1" style="border:none;display:block;" alt="" /></td><td></td>
		<td id="MH1_1"><a href="WaarpR66Technical.html" onmouseover="MHSwitchImage('MH1_1_img', 'gre/gre6709.png');" onmouseout="MHSwitchImage('MH1_1_img', 'gre/gre6709.png');"><img id="MH1_1_img" src="gre/gre6709.png" width="175" height="26" alt="Waarp R66-Technical" style="border:none;display:block;" /></a></td>
		<td></td><td><img src="gre/gre6667.png" height="18" width="1" style="border:none;display:block;" alt="" /></td><td></td>
		<td id="MH1_2"><a href="WaarpR66Installation.html" onmouseover="MHSwitchImage('MH1_2_img', 'gre/gre6711.png');" onmouseout="MHSwitchImage('MH1_2_img', 'gre/gre6710.png');"><img id="MH1_2_img" src="gre/gre6710.png" width="171" height="26" alt="Waarp R66-Installation" style="border:none;display:block;" /></a></td>
		<td></td><td><img src="gre/gre6667.png" height="18" width="1" style="border:none;display:block;" alt="" /></td><td></td>
		<td id="MH1_3"><a href="WaarpR66Production.html" onmouseover="MHSwitchImage('MH1_3_img', 'gre/gre6713.png');" onmouseout="MHSwitchImage('MH1_3_img', 'gre/gre6712.png');"><img id="MH1_3_img" src="gre/gre6712.png" width="167" height="26" alt="Waarp R66-Production" style="border:none;display:block;" /></a></td>
		<td style="width:100%;"><img src="img/space.gif" width="1" height="1" style="border:none;display:block;" alt="" /></td>
	<td><img src="gre/gre6668.png" height="26" width="1" style="border:none;display:block;" alt="" /></td>
	</tr>
</table>
</div></td></tr>
<tr>
<td style="vertical-align:top;width:100px;">
<div id="Comp6_MenuVertical" style="text-align:left;"><div id="mvg1"><a href="index.html" onmouseover="mvgSwitchImage('mvg1_0_img', 'gre/gre6671.png');" onmouseout="mvgSwitchImage('mvg1_0_img', 'gre/gre6669.png');"><img id="mvg1_0_img" src="gre/gre6669.png" width="150" height="31" alt="Home" style="display:block;border:none;" /></a>
<a href="WorldofWaarp.html" onmouseover="mvgSwitchImage('mvg1_1_img', 'gre/gre6674.png');" onmouseout="mvgSwitchImage('mvg1_1_img', 'gre/gre6672.png');"><img id="mvg1_1_img" src="gre/gre6672.png" width="150" height="31" alt="World of Waarp" style="display:block;border:none;" /></a>
<a href="WaarpR66.html" onmouseover="mvgSwitchImage('mvg1_2_img', 'gre/gre6677.png');" onmouseout="mvgSwitchImage('mvg1_2_img', 'gre/gre6676.png');"><img id="mvg1_2_img" src="gre/gre6676.png" width="150" height="31" alt="Waarp R66" style="display:block;border:none;" /></a>
<a href="WaarpFTP.html" onmouseover="mvgSwitchImage('mvg1_3_img', 'gre/gre6725.png');" onmouseout="mvgSwitchImage('mvg1_3_img', 'gre/gre6723.png');"><img id="mvg1_3_img" src="gre/gre6723.png" width="150" height="31" alt="Waarp FTP" style="display:block;border:none;" /></a>
<a href="WaarpGatewayFtp.html" onmouseover="mvgSwitchImage('mvg1_4_img', 'gre/gre6731.png');" onmouseout="mvgSwitchImage('mvg1_4_img', 'gre/gre6729.png');"><img id="mvg1_4_img" src="gre/gre6729.png" width="150" height="31" alt="WaarpGatewayFtp" style="display:block;border:none;" /></a>
<a href="WaarpGatewayHttp.html" onmouseover="mvgSwitchImage('mvg1_5_img', 'gre/gre6737.png');" onmouseout="mvgSwitchImage('mvg1_5_img', 'gre/gre6735.png');"><img id="mvg1_5_img" src="gre/gre6735.png" width="150" height="31" alt="WaarpGatewayHttp" style="display:block;border:none;" /></a>
<a href="WaarpCommons.html" onmouseover="mvgSwitchImage('mvg1_6_img', 'gre/gre6722.png');" onmouseout="mvgSwitchImage('mvg1_6_img', 'gre/gre6720.png');"><img id="mvg1_6_img" src="gre/gre6720.png" width="150" height="31" alt="Waarp Commons" style="display:block;border:none;" /></a>
<a href="APIReferences.html" onmouseover="mvgSwitchImage('mvg1_7_img', 'gre/gre6689.png');" onmouseout="mvgSwitchImage('mvg1_7_img', 'gre/gre6687.png');"><img id="mvg1_7_img" src="gre/gre6687.png" width="150" height="31" alt="API References" style="display:block;border:none;" /></a>
<a href="Downloads.html" onmouseover="mvgSwitchImage('mvg1_8_img', 'gre/gre6692.png');" onmouseout="mvgSwitchImage('mvg1_8_img', 'gre/gre6690.png');"><img id="mvg1_8_img" src="gre/gre6690.png" width="150" height="31" alt="Downloads" style="display:block;border:none;" /></a>
<a href="WaarpDependson.html" onmouseover="mvgSwitchImage('mvg1_9_img', 'gre/gre6695.png');" onmouseout="mvgSwitchImage('mvg1_9_img', 'gre/gre6693.png');"><img id="mvg1_9_img" src="gre/gre6693.png" width="150" height="31" alt="Waarp Depends on" style="display:block;border:none;" /></a>
</div></div></td>
<td style="padding-right:5px;padding-left:5px;padding-bottom:5px;vertical-align:top;width:100%;padding-top:5px;">
<h1 class="h1">Waarp R66-Protocol</h1>
<div id="Comp1_sys_doctext"><p style="text-align:justify;"><span style="font-size:11pt;">We describe here the logic of the protocol. It has been designed to be efficient, secured and to fullfill specific requirements of MFT and integration in IT.</span></p>
<p style="text-align:justify;">&nbsp;</p>
<p style="text-align:justify;"><span style="font-size:11pt;">A simplified picture is shown here:</span></p>
<p style="text-align:justify;"><img title="openr66-protocol" alt="openr66-protocol" src="res/document/openr66protocol.png" width="1168" height="220" /></p>
<p style="text-align:justify;"><span style="font-size:11pt;">First we describe the different value that can be found.</span></p>
<ul>
<li>
<div style="text-align:justify;"><span style="font-size:11pt;">A Request (DbTaskRunner) can have several UpdatedInfo status:</span></div>
<ul>
<li><div style="text-align:justify;"><span style="font-size:11pt;">UNKNOWN : no particular information on it.</span></div></li>

<li><div style="text-align:justify;"><span style="font-size:11pt;">NOTUPDATED : in used by other database object when they are taken into account.</span></div></li>

<li><div style="text-align:justify;"><span style="font-size:11pt;">INTERRUPTED : a request is interrupted but can be rescheduled.</span></div></li>

<li><div style="text-align:justify;"><span style="font-size:11pt;">TOSUBMIT : a request is proposed to be submited by the Commander (or other database object are supposed to be taken into account).</span></div></li>

<li><div style="text-align:justify;"><span style="font-size:11pt;">INERROR : a request is in error and can not be submited by the Commander until its status is changed explicitely.</span></div></li>

<li><div style="text-align:justify;"><span style="font-size:11pt;">RUNNING : a request is currently running.</span></div></li>

<li>
<div style="text-align:justify;"><span style="font-size:11pt;">DONE : a request is over and fully done.</span></div></li></ul></li></ul>
<ul>
<li><div style="text-align:justify;"><span style="font-size:11pt;">A Request can have several Step values:</span></div><ul>
<li><div style="text-align:justify;"><span style="font-size:11pt;">NOTASK : the request has never started.</span></div></li>

<li><div style="text-align:justify;"><span style="font-size:11pt;">PRETASK : the request is currently in Pre transfer step.</span></div></li>

<li><div style="text-align:justify;"><span style="font-size:11pt;">TRANSFERTASK : the request is currently in transfer step.</span></div></li>

<li><div style="text-align:justify;"><span style="font-size:11pt;">POSTTASK : the request is currently in Post transfer step (valid transfer only).</span></div></li>

<li><div style="text-align:justify;"><span style="font-size:11pt;">ALLDONETASK : the request is fully finished (UpdatedInfo is in DONE status too).</span></div></li>

<li>
<div style="text-align:justify;"><span style="font-size:11pt;">ERRORTASK : the request is currently in the Error step while an error occurs (either in PRE, TRANSFER or POST step).</span></div></li></ul></li>


<li>
<div style="text-align:justify;"><span style="font-size:11pt;">A Request has two Step values:</span></div>
<ul>
<li><div style="text-align:justify;"><span style="font-size:11pt;">GlobalStep : the current request step value</span></div></li>

<li>
<div style="text-align:justify;"><span style="font-size:11pt;">GlobalLastStep : this is the last valid request step value. When GlobalStep is in ERROR step, GlobalLastStep says in which step it was before entering in error. This information is used to enable restart of the Request from this valid last step.</span></div></li></ul></li></ul>
<ul>
<li>
<div style="text-align:justify;"><span style="font-size:11pt;">Each Step values and UpdatedInfo has an ErrorCode detailed information:</span></div>
<ul>
<li><div style="text-align:justify;"><span style="font-size:11pt;"><em>InitOk</em> : stands for correct initialization of the Request (startup and authentication)</span></div></li>

<li><div style="text-align:justify;"><span style="font-size:11pt;"><em>PreProcessingOk, TransferOk, PostProcessingOk</em> : stand for correct ending of the specified step</span></div></li>

<li><div style="text-align:justify;"><span style="font-size:11pt;"><em>CompleteOk</em> : stands for all action are correct (ALLDONE for step and DONE for UpdatedInfo)</span></div></li>

<li><div style="text-align:justify;"><span style="font-size:11pt;"><em>Running</em> : stands for current Step is in Running status.</span></div></li>

<li><div style="text-align:justify;"><span style="font-size:11pt;"><em>StoppedTransfer, CanceledTransfer</em> : stand for a Request where an action stopped or canceled the given Request. A Stopped Request can be restart from the current status. A Canceled Request starts from the beginning of the current step. For instance for the Transfer step, Stopped will imply that restart is from the current valid transferred block, while Cancel will imply to restart from the very beginning of the transfer (first block).</span></div></li>

<li><div style="text-align:justify;"><span style="font-size:11pt;"><em>QueryAlreadyFinished</em> : stands for special code where the Request is in fact remotely already finished and so can be finished locally.</span></div></li>

<li><div style="text-align:justify;"><span style="font-size:11pt;">Other codes specifies different kinds of error (NotKnownHost, Shutdown, RemoteError, ...):</span>&nbsp;</div></li>

<li>
<div style="text-align:justify;">
<ul>
<li><span style="color:#000000;"><span style="font-size:11pt;"><em>ConnectionImpossible&nbsp;</em>: connection is impossible (local or remote)</span></span> 
</li><li><span style="color:#000000;"><span style="font-size:11pt;"><em>BadAuthent&nbsp;</em>: authentication is in error (local or remote)</span></span> 
</li><li><span style="color:#000000;"><span style="font-size:11pt;"><em>ExternalOp&nbsp;</em>: external operation is in error (pre, post or error actions)</span></span> 
</li><li><span style="color:#000000;"><span style="font-size:11pt;"><em>TransferError&nbsp;</em>: transfer is in error (for instance, uncorrect block)</span></span> 
</li><li><span style="color:#000000;"><span style="font-size:11pt;"><em>MD5Error&nbsp;</em>: transfer is in error due to a bad MD5 checking (in MD5 mode)</span></span> 
</li><li><span style="color:#000000;"><span style="font-size:11pt;"><em>Disconnection&nbsp;</em>: the network was disconnected</span></span> 
</li><li><span style="color:#000000;"><span style="font-size:11pt;"><em>RemoteShutdown&nbsp;</em>: the remote host is in shutdown</span></span> 
</li><li><span style="color:#000000;"><span style="font-size:11pt;"><em>Shutdown&nbsp;</em>: the local host is in shutdown</span></span> 
</li><li><span style="color:#000000;"><span style="font-size:11pt;"><em>FinalOp&nbsp;</em>: a final operation (not an external operation) is in error (for instance the finalization of the received file)</span></span> 
</li><li><span style="color:#000000;"><span style="font-size:11pt;"><em>Unimplemented&nbsp;</em>: the requested command is unimplemented (for instance, a task in a rule is unknown)</span></span> 
</li><li><span style="color:#000000;"><span style="font-size:11pt;"><em>RemoteError&nbsp;</em>: a remote error was received and&nbsp;stops the transfer</span></span> 
</li><li><span style="color:#000000;"><span style="font-size:11pt;"><em>Internal&nbsp;</em>: an internal error arrives</span></span> 
</li><li><span style="color:#000000;"><span style="font-size:11pt;"><em>Warning&nbsp;</em>: an external execution (pre or post operation) is executed well but with a warning (code 1)</span></span> 
</li><li><span style="color:#000000;"><span style="font-size:11pt;"><em>Unknown&nbsp;</em>: an unknown error arrives</span></span> 
</li><li><span style="color:#000000;"><span style="font-size:11pt;"><em>QueryStillRunning&nbsp;: </em>a required transfer during a restart is still in transfer</span></span> 
</li><li><span style="color:#000000;"><span style="font-size:11pt;"><em>NotKnownHost&nbsp;: </em>the remote host is unknown</span></span> 
</li><li><span style="color:#000000;"><span style="font-size:11pt;"><em>QueryRemotelyUnknown&nbsp;: </em>a required transfer during a restart or other commands should exist but is not identified on the remote host (for instance after a purge of log)</span></span> 
</li><li><span style="color:#000000;"><span style="font-size:11pt;"><em>FileNotFound&nbsp;: </em>the file is not found</span></span> 
</li><li><span style="color:#000000;"><span style="font-size:11pt;"><em>CommandNotFound&nbsp;: </em>the Command is not found</span></span>&nbsp;</li></ul></div>
<ul>
<li><span style="color:#000000;"><span style="font-size:11pt;"><em>PassThroughMode&nbsp;: </em>the requested transfer (restart) is in PassThrough mode and is not compatible with the required action</span></span></li></ul></li></ul></li></ul>
<p style="text-align:justify;"><span style="font-size:11pt;">A request of transfer follows a sequential logic:</span></p>
<ol>
<li><div style="text-align:justify;"><span style="font-size:11pt;">The request is registered in the database with a TOSUBMIT status.</span></div></li>

<li><div style="text-align:justify;"><span style="font-size:11pt;">A Request that was in a INTERRUPTED status is changed in a TOSUBMIT status.</span></div></li>

<li><div style="text-align:justify;"><span style="font-size:11pt;">The Commander get some requests with the TOSUBMIT status and makes them as RUNNING status.</span></div></li>

<li><div style="text-align:justify;"><span style="font-size:11pt;">The Commander submits those requests as separates ClientRunners.</span></div></li>

<li><div style="text-align:justify;"><span style="font-size:11pt;">The ClientRunner first checks that the given Request is not a "Self Requested" request, meaning that only requester host can execute a ClientRunner, except if this request was in the POSTTASK step so that Requested Host can finalize the request.</span></div></li>

<li><div style="text-align:justify;"><span style="font-size:11pt;">The ClientRunner gets the remote requested Host address and tries to open the connection. If a network conection with the given requested host is already opened, this network connection is reused by the new ClientRunner.</span></div></li>

<li><div style="text-align:justify;"><span style="font-size:11pt;">The connection can use SSL support (different port than non SSL). This is an option of transfer. This option is selected while selecting the Host ID for SSL support for the remote Requested Host. This option is CPU and Memory consuming.</span></div></li>

<li><div style="text-align:justify;"><span style="font-size:11pt;">Once the network connection is found, a private connection (in memory connection) is opened to enable the multiplexing of this request with other requests on the same network connection. This private connection is attached to a new LocalChannelReference which references the Request, the session, the remote and&nbsp;private connections. A valid LocalChannelReference contains two private connection Ids, one for the local private connection, and one for the remote private connection.</span></div><ol>
<li><div style="text-align:justify;"><span style="font-size:11pt;">A Startup Message is sent to the local private connection to initiate it.</span></div></li>

<li>
<div style="text-align:justify;"><span style="font-size:11pt;">The same Startup Message is sent on the remote private side (when connection occurs) to initiate the relation between them and to instantiate the same LocalChannelReference on the remote host.</span></div></li></ol></li>


<li><div style="text-align:justify;"><span style="font-size:11pt;">Once the LocalChannelReference is OK, the Requester host sends an Authent Message in order to authenticate this host.</span></div></li>

<li><div style="text-align:justify;"><span style="font-size:11pt;">The Requested host sends back its own Authent Message too.</span></div></li>

<li><div style="text-align:justify;"><span style="font-size:11pt;">Once authenticated, the Requester Host sends the Request Message.</span></div></li>

<li><div style="text-align:justify;"><span style="font-size:11pt;">The Requested Host check if the authentication and the request are compatibles, check some specific options on the request itself (start, restart, ...), then it runs its Pre Task step</span></div><ul>
<li>
<div style="text-align:justify;">
<p style="text-align:justify;"><span style="font-size:11pt;">The Request is in&nbsp;PreProcessingOK as status.</span></p></div></li></ul></li>


<li><div style="text-align:justify;"><span style="font-size:11pt;">If the Pre Task step is ok, it sends back the validated request to the Requester Host. </span></div><ul>
<li>
<div style="text-align:justify;"><span style="font-size:11pt;">The Request is in InitOk as detailed information on requester side.</span></div></li></ul></li>


<li><div style="text-align:justify;"><span style="font-size:11pt;">The validated Request is now running the Pre Task step. </span></div><ul>
<li>
<div style="text-align:justify;"><span style="font-size:11pt;">Once finished, the Request is in PreProcessingOK status.</span></div></li></ul></li>


<li><div style="text-align:justify;"><span style="font-size:11pt;">Now the transmission can start. From now, this is the sender that leads the communication, no more the requester (it could be the same host however, depending on the way of transfer). The sender (which could be either the Requested or the Requester host) launch its own RetrieveRunner. This RetrieveRunner sends to the other host all DataBlock Messages.</span></div></li>

<li><div style="text-align:justify;"><span style="font-size:11pt;">Each DataBlock Message can include a Hash control (MD5 or SHA or other) of the packet in it (option of transfer). This option is not mandatory and is CPU consuming.</span></div></li>

<li><div style="text-align:justify;"><span style="font-size:11pt;">Once all DataBlock are sent, the RetrieveRunner sends an EndTransfer Message to the receiver host.</span></div></li>

<li><div style="text-align:justify;"><span style="font-size:11pt;">The receiver host executes the Post actions.</span></div><ul>
<li>
<div style="text-align:justify;">
<p style="text-align:justify;"><span style="font-size:11pt;">The Request is in PostProcesseingOk status.</span></p></div></li></ul></li>


<li><div style="text-align:justify;"><span style="font-size:11pt;">The receiver host sends back the validated EndTransfer Message. </span></div><ul>
<li>
<div style="text-align:justify;"><span style="font-size:11pt;">The Request is in TransferOk status on sender side.</span></div></li></ul></li>


<li><div style="text-align:justify;"><span style="font-size:11pt;">The Request is now on Finalize way. Sender host executes the Post actions.</span></div><ul>
<li>
<div style="text-align:justify;"><span style="font-size:11pt;">The Request is in PostProcesseingOk status.</span></div></li></ul></li>


<li><div style="text-align:justify;"><span style="font-size:11pt;">Once the PostProcessing is over, the RetrieveRunner (Sender) sends to the remote host a EndRequest Message.</span></div></li>

<li><div style="text-align:justify;"><span style="font-size:11pt;">The remote host sends back the validated EndRequest Message.</span></div></li>

<li>
<div style="text-align:justify;"><span style="font-size:11pt;">The Request is now totally finished and its status is CompleteOk ALLDONE.</span></div></li></ol>
<p style="text-align:justify;"><span style="font-size:11pt;">At each step, an error can occurs and will stop the request, setting its UpdatedInfo to INERROR or INTERRUPTED status. The GlobalStep could be in ERROR status if the ERROR step action is run.</span></p>
<p style="text-align:justify;"></p>
<p style="text-align:justify;"></p>
<p style="text-align:justify;">&nbsp;</p></div></td></tr></tbody></table>
<div id="Comp7_CodeRelayer"><script src="http://www.google-analytics.com/urchin.js" type="text/javascript">
</script>
<script type="text/javascript">
_uacct = "UA-1693657-4";
urchinTracker();
</script>
</div></div>
</body>
</html>
